<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Small Multiples • unpivotr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Small Multiples">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-5');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unpivotr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/compass-directions.html">Compass Directions</a>
    </li>
    <li>
      <a href="../articles/html.html">HTML Tables</a>
    </li>
    <li>
      <a href="../articles/small-multiples.html">Small Multiples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nacnudus/unpivotr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Small Multiples</h1>
                        <h4 class="author">Duncan Garmonsway</h4>
            
            <h4 class="date">2019-03-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nacnudus/unpivotr/blob/master/vignettes/small-multiples.Rmd"><code>vignettes/small-multiples.Rmd</code></a></small>
      <div class="hidden name"><code>small-multiples.Rmd</code></div>

    </div>

    
    
<p>This vignette for the <a href="https://github.com/nacnudus/unpivotr">unpivotr</a> package demonstrates unpivoting multiple similar tables from a spreadsheet via the <a href="https://github.com/nacnudus/tidyxl">tidyxl</a> package. It is best read with the spreadsheet open in a spreadsheet program, e.g. Excel, LibreOffice Calc or Gnumeric.</p>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The spreadsheet is from the famous Enron subpoena, made available by <a href="http://www.felienne.com/archives/3634">Felienne Hermans</a>, and has has previously been publicised by Jenny Bryan and David Robinson, in particular in Robinson’s article <a href="https://rpubs.com/dgrtwo/tidying-enron">‘Tidying an untidyable dataset’</a>.</p>
<p>Here’s a screenshot:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/include_graphics">include_graphics</a></span>(<span class="st">"enron-screenshot.png"</span>)</a></code></pre></div>
<p><img src="enron-screenshot.png" width="850px"></p>
</div>
<div id="preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation" class="anchor"></a>Preparation</h2>
<p>This vignette uses several common packages.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(unpivotr)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">library</span>(tidyxl)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">library</span>(stringr)</a></code></pre></div>
<p>The spreadsheet is distributed with the unpivotr package, so can be loaded as a system file.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata/enron.xlsx"</span>, <span class="dt">package =</span> <span class="st">"unpivotr"</span>)</a></code></pre></div>
</div>
<div id="main" class="section level2">
<h2 class="hasAnchor">
<a href="#main" class="anchor"></a>Main</h2>
<div id="importing-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#importing-the-data" class="anchor"></a>Importing the data</h3>
<p>Spreadsheet cells are imported with the <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells()</a></code> function, which returns a data frame of all the cells in all the requested sheets. By default, every sheet is imported, but we don’t have to worry about that in this case because there is only one sheet in the file. We can also straightaway discard rows above 14 and below 56, and columns beyond 20.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">cells &lt;-</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(row, 14L, 56L), col <span class="op">&lt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, numeric, character, date)</a></code></pre></div>
<p>Cell formatting isn’t required for this vignette, but if it were, it would be imported via <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats(path)</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">formatting &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a></code></pre></div>
</div>
<div id="importing-one-of-the-multiples" class="section level3">
<h3 class="hasAnchor">
<a href="#importing-one-of-the-multiples" class="anchor"></a>Importing one of the multiples</h3>
<p>The small multiples each have exactly one ‘Fixed Price’ header cell, so begin by filtering for those cells, and then move the selection up one row to get the title cells. The title cells are the top-left corner cell of each table.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">title &lt;-</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cells, character <span class="op">==</span><span class="st"> "Fixed Price"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">row =</span> row <span class="op">-</span><span class="st"> </span>1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(cells, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>))</a></code></pre></div>
<p>Use these title cells to partition the sheet.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">partitions &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partition.html">partition</a></span>(cells, title)</a></code></pre></div>
<p>Taking one of the partitions, unpivot with <code><a href="../reference/behead.html">behead()</a></code>. The compass directions <code>"NNW"</code> and <code>"N"</code> express the direction from each data cell to its header. <code>"NNW"</code> means “look up and then left to find the nearest header.”</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">partitions<span class="op">$</span>cells[[<span class="dv">1</span>]] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"NNW"</span>, <span class="st">"title"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"NNW"</span>, <span class="st">"price"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"N"</span>, <span class="st">"bid_offer"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a></code></pre></div>
<pre><code>## # A tibble: 24 x 9
##      row   col data_type numeric character date                title price
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt;
##  1    17    17 numeric     1.89  &lt;NA&gt;      NA                  IF N… Fixe…
##  2    17    18 numeric     1.91  &lt;NA&gt;      NA                  IF N… Fixe…
##  3    18    17 numeric     2.06  &lt;NA&gt;      NA                  IF N… Fixe…
##  4    18    18 numeric     2.08  &lt;NA&gt;      NA                  IF N… Fixe…
##  5    19    17 numeric     2.40  &lt;NA&gt;      NA                  IF N… Fixe…
##  6    19    18 numeric     2.42  &lt;NA&gt;      NA                  IF N… Fixe…
##  7    20    17 numeric     2.59  &lt;NA&gt;      NA                  IF N… Fixe…
##  8    20    18 numeric     2.61  &lt;NA&gt;      NA                  IF N… Fixe…
##  9    21    17 numeric     2.58  &lt;NA&gt;      NA                  IF N… Fixe…
## 10    21    18 numeric     2.60  &lt;NA&gt;      NA                  IF N… Fixe…
## 11    22    17 numeric     3.36  &lt;NA&gt;      NA                  IF N… Fixe…
## 12    22    18 numeric     3.38  &lt;NA&gt;      NA                  IF N… Fixe…
## 13    23    17 numeric     2.63  &lt;NA&gt;      NA                  IF N… Fixe…
## 14    23    18 numeric     2.65  &lt;NA&gt;      NA                  IF N… Fixe…
## 15    19    19 numeric    -0.565 &lt;NA&gt;      NA                  IF N… Basis
## 16    19    20 numeric    -0.545 &lt;NA&gt;      NA                  IF N… Basis
## 17    20    19 numeric    -0.494 &lt;NA&gt;      NA                  IF N… Basis
## 18    20    20 numeric    -0.474 &lt;NA&gt;      NA                  IF N… Basis
## 19    21    19 numeric    -0.585 &lt;NA&gt;      NA                  IF N… Basis
## 20    21    20 numeric    -0.565 &lt;NA&gt;      NA                  IF N… Basis
## 21    22    19 numeric    -0.295 &lt;NA&gt;      NA                  IF N… Basis
## 22    22    20 numeric    -0.275 &lt;NA&gt;      NA                  IF N… Basis
## 23    23    19 numeric    -0.530 &lt;NA&gt;      NA                  IF N… Basis
## 24    23    20 numeric    -0.510 &lt;NA&gt;      NA                  IF N… Basis
## # … with 1 more variable: bid_offer &lt;chr&gt;</code></pre>
<p>The same procedure can be mapped to every small multiple.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">unpivoted &lt;-</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(partitions<span class="op">$</span>cells,</a>
<a class="sourceLine" id="cb14-3" title="3">                 <span class="op">~</span><span class="st"> </span>.x <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="st">                   </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"NNW"</span>, <span class="st">"title"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="st">                   </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"NNW"</span>, <span class="st">"price"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="st">                   </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"N"</span>, <span class="st">"bid_offer"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>data_type, <span class="op">-</span>character, <span class="op">-</span>date)</a>
<a class="sourceLine" id="cb14-8" title="8">unpivoted</a></code></pre></div>
<pre><code>## # A tibble: 240 x 6
##      row   col numeric title                   price       bid_offer
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;       &lt;chr&gt;    
##  1    17    17    1.89 IF NWPL Rocky Mountains Fixed Price BID      
##  2    17    18    1.91 IF NWPL Rocky Mountains Fixed Price OFFER    
##  3    18    17    2.06 IF NWPL Rocky Mountains Fixed Price BID      
##  4    18    18    2.08 IF NWPL Rocky Mountains Fixed Price OFFER    
##  5    19    17    2.40 IF NWPL Rocky Mountains Fixed Price BID      
##  6    19    18    2.42 IF NWPL Rocky Mountains Fixed Price OFFER    
##  7    20    17    2.59 IF NWPL Rocky Mountains Fixed Price BID      
##  8    20    18    2.61 IF NWPL Rocky Mountains Fixed Price OFFER    
##  9    21    17    2.58 IF NWPL Rocky Mountains Fixed Price BID      
## 10    21    18    2.60 IF NWPL Rocky Mountains Fixed Price OFFER    
## # … with 230 more rows</code></pre>
<p>So far, only the column headers have been joined, but there are also row headers on the left-hand side of the spreadsheet. The following code incorporates these into the final dataset.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">row_headers &lt;-</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(row, <span class="dv">17</span>, <span class="dv">56</span>), <span class="kw"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(col, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="st">  </span><span class="co"># Concatenate rows like "Dec-01", "to", "Mar-02"</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">character =</span> <span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(character),</a>
<a class="sourceLine" id="cb16-6" title="6">                            character,</a>
<a class="sourceLine" id="cb16-7" title="7">                            <span class="kw">format</span>(date, <span class="dt">origin=</span><span class="st">"1899-12-30"</span>, <span class="st">"%b-%y"</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>(<span class="op">-</span>row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">row_header =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(data,</a>
<a class="sourceLine" id="cb16-11" title="11">                          <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span>(<span class="kw">paste</span>(.x<span class="op">$</span>character, <span class="dt">collapse =</span> <span class="st">" "</span>)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>(row_header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-13" title="13"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">col =</span> 2L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, row_header)</a>
<a class="sourceLine" id="cb16-15" title="15">unpivoted &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(unpivoted, row_headers, <span class="dt">by =</span> <span class="st">"row"</span>)</a>
<a class="sourceLine" id="cb16-16" title="16">unpivoted</a></code></pre></div>
<pre><code>## # A tibble: 240 x 7
##      row   col numeric title             price     bid_offer row_header    
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;         
##  1    17    17    1.89 IF NWPL Rocky Mo… Fixed Pr… BID       Cash          
##  2    17    18    1.91 IF NWPL Rocky Mo… Fixed Pr… OFFER     Cash          
##  3    18    17    2.06 IF NWPL Rocky Mo… Fixed Pr… BID       ROM           
##  4    18    18    2.08 IF NWPL Rocky Mo… Fixed Pr… OFFER     ROM           
##  5    19    17    2.40 IF NWPL Rocky Mo… Fixed Pr… BID       Dec-01        
##  6    19    18    2.42 IF NWPL Rocky Mo… Fixed Pr… OFFER     Dec-01        
##  7    20    17    2.59 IF NWPL Rocky Mo… Fixed Pr… BID       Dec-01 to Mar…
##  8    20    18    2.61 IF NWPL Rocky Mo… Fixed Pr… OFFER     Dec-01 to Mar…
##  9    21    17    2.58 IF NWPL Rocky Mo… Fixed Pr… BID       Apr-02 to Oct…
## 10    21    18    2.60 IF NWPL Rocky Mo… Fixed Pr… OFFER     Apr-02 to Oct…
## # … with 230 more rows</code></pre>
</div>
</div>
<div id="line-code-listing" class="section level2">
<h2 class="hasAnchor">
<a href="#line-code-listing" class="anchor"></a>34-line code listing</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">library</span>(unpivotr)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw">library</span>(tidyxl)</a>
<a class="sourceLine" id="cb18-3" title="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb18-4" title="4"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb18-5" title="5"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb18-6" title="6"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb18-7" title="7"></a>
<a class="sourceLine" id="cb18-8" title="8">cells &lt;-</a>
<a class="sourceLine" id="cb18-9" title="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(<span class="kw">system.file</span>(<span class="st">"extdata/enron.xlsx"</span>, <span class="dt">package =</span> <span class="st">"unpivotr"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(row, 14L, 56L), col <span class="op">&lt;=</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-11" title="11"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, numeric, character, date)</a>
<a class="sourceLine" id="cb18-12" title="12"></a>
<a class="sourceLine" id="cb18-13" title="13">row_headers &lt;-</a>
<a class="sourceLine" id="cb18-14" title="14"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cells, <span class="kw"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(row, <span class="dv">17</span>, <span class="dv">56</span>), <span class="kw"><a href="https://dplyr.tidyverse.org/reference/between.html">between</a></span>(col, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-15" title="15"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">character =</span> <span class="kw">ifelse</span>(<span class="op">!</span><span class="kw">is.na</span>(character),</a>
<a class="sourceLine" id="cb18-16" title="16">                            character,</a>
<a class="sourceLine" id="cb18-17" title="17">                            <span class="kw">format</span>(date, <span class="dt">origin=</span><span class="st">"1899-12-30"</span>, <span class="st">"%b-%y"</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-18" title="18"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-19" title="19"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>(<span class="op">-</span>row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-20" title="20"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">row_header =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(data,</a>
<a class="sourceLine" id="cb18-21" title="21">                          <span class="op">~</span><span class="st"> </span><span class="kw"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span>(<span class="kw">paste</span>(.x<span class="op">$</span>character, <span class="dt">collapse =</span> <span class="st">" "</span>)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-22" title="22"><span class="st">  </span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/unnest.html">unnest</a></span>(row_header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-23" title="23"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">col =</span> 2L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-24" title="24"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, row_header)</a>
<a class="sourceLine" id="cb18-25" title="25"></a>
<a class="sourceLine" id="cb18-26" title="26">titles &lt;-</a>
<a class="sourceLine" id="cb18-27" title="27"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cells, character <span class="op">==</span><span class="st"> "Fixed Price"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-28" title="28"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-29" title="29"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">row =</span> row <span class="op">-</span><span class="st"> </span>1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-30" title="30"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">inner_join</a></span>(cells, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>))</a>
<a class="sourceLine" id="cb18-31" title="31"></a>
<a class="sourceLine" id="cb18-32" title="32"><span class="kw"><a href="../reference/partition.html">partition</a></span>(cells, titles)<span class="op">$</span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-33" title="33"><span class="st">  </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span>(<span class="op">~</span><span class="st"> </span>.x <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-34" title="34"><span class="st">                 </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"NNW"</span>, <span class="st">"title"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-35" title="35"><span class="st">                 </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"NNW"</span>, <span class="st">"price"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-36" title="36"><span class="st">                 </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(<span class="st">"N"</span>, <span class="st">"bid_offer"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-37" title="37"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>data_type, <span class="op">-</span>character, <span class="op">-</span>date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-38" title="38"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(row_headers, <span class="dt">by =</span> <span class="st">"row"</span>)</a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#preparation">Preparation</a></li>
      <li><a href="#main">Main</a></li>
      <li><a href="#line-code-listing">34-line code listing</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
