<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Tokenize data frames into a tidy 'melted' structure — as_cells • unpivotr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Tokenize data frames into a tidy 'melted' structure — as_cells" />

<meta property="og:description" content="Data frames represent data in a tabular structure.  as_cells()
takes the row and column position of each 'cell', and returns that
information in a new data frame, alongside the content and type of each cell.
This makes it easier to deal with complex or non-tabular data (e.g. pivot
tables) that have been imported into R as data frames.  Once they have been
'melted' by as_cells(), you can use functions like behead() and
spatter() to reshape them into conventional, tidy, unpivoted structures.
For HTML tables, the content of each cell is returned as a standalone HTML
string that can be further parsed with tools such as the rvest package.  This
is particularly useful when an HTML cell itself contains an HTML table, or
contains both text and a URL.  If the HTML itself is poorly formatted, try
passing it through the
htmltidy package first.
This is an S3 generic." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-5');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unpivotr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/compass-directions.html">Compass Directions</a>
    </li>
    <li>
      <a href="../articles/html.html">HTML Tables</a>
    </li>
    <li>
      <a href="../articles/small-multiples.html">Small Multiples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nacnudus/unpivotr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Tokenize data frames into a tidy 'melted' structure</h1>
    <small class="dont-index">Source: <a href='https://github.com/nacnudus/unpivotr/blob/master/R/as_cells.R'><code>R/as_cells.R</code></a></small>
    <div class="hidden name"><code>as_cells.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Data frames represent data in a tabular structure.  <code>as_cells()</code>
takes the row and column position of each 'cell', and returns that
information in a new data frame, alongside the content and type of each cell.</p>
<p>This makes it easier to deal with complex or non-tabular data (e.g. pivot
tables) that have been imported into R as data frames.  Once they have been
'melted' by <code>as_cells()</code>, you can use functions like <code><a href='behead.html'>behead()</a></code> and
<code><a href='spatter.html'>spatter()</a></code> to reshape them into conventional, tidy, unpivoted structures.</p>
<p>For HTML tables, the content of each cell is returned as a standalone HTML
string that can be further parsed with tools such as the rvest package.  This
is particularly useful when an HTML cell itself contains an HTML table, or
contains both text and a URL.  If the HTML itself is poorly formatted, try
passing it through the
<a href='https://CRAN.R-project.org/package=htmltidy'>htmltidy</a> package first.</p>
<p>This is an S3 generic.</p>
    
    </div>

    <pre class="usage"><span class='fu'>as_cells</span>(<span class='no'>x</span>, <span class='kw'>row_names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>col_names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A data.frame or an HTML document</p></td>
    </tr>
    <tr>
      <th>row_names</th>
      <td><p>Whether to treat the row names as cells, Default: FALSE</p></td>
    </tr>
    <tr>
      <th>col_names</th>
      <td><p>Whether to treat the column names  as cells, Default: FALSE</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data.frame with the following columns:</p><ul>
<li><p><code>row</code> and <code>col</code> (integer) giving the original position of the 'cells'</p></li>
<li><p>any relevant columns for cell values in their original types: <code>chr</code>,
<code>cplx</code>, <code>cplx</code>, <code>dbl</code>, <code>fct</code>, <code>int</code>, <code>lgl</code>, <code>list</code>, and <code>ord</code></p></li>
<li><p><code>data_type</code> to specify for each cell which of the above columns (<code>chr</code>
etc.) the value is in.</p></li>
</ul>

<p>The columns <code>fct</code> and <code>ord</code> are, like <code>list</code>, list-columns (each element is
independent) to avoid factor levels clashing.  For HTML tables, the column
<code>html</code> gives the HTML string of the original cell.</p>
<p>Row and column names, when present and required by <code>row_names = TRUE</code> or
<code>col_names = TRUE</code>, are treated as though they were cells in the table, and
they appear in the <code>chr</code> column.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For certain non-rectangular data formats, it can be useful to parse
the data into a melted format where each row represents a single
token.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>10</span>, <span class='fl'>20</span>),
                <span class='kw'>b</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"foo"</span>, <span class='st'>"bar"</span>),
                <span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>x</span></div><div class='output co'>#&gt;    a   b
#&gt; 1 10 foo
#&gt; 2 20 bar</div><div class='input'><span class='fu'>as_cells</span>(<span class='no'>x</span>)</div><div class='output co'>#&gt; # A tibble: 4 x 5
#&gt;     row   col data_type chr     dbl
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1     1 dbl       &lt;NA&gt;     10
#&gt; 2     2     1 dbl       &lt;NA&gt;     20
#&gt; 3     1     2 chr       foo      NA
#&gt; 4     2     2 chr       bar      NA</div><div class='input'><span class='fu'>as_cells</span>(<span class='no'>x</span>, <span class='kw'>row_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; # A tibble: 6 x 5
#&gt;     row   col data_type chr     dbl
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1     1 chr       1        NA
#&gt; 2     2     1 chr       2        NA
#&gt; 3     1     2 dbl       &lt;NA&gt;     10
#&gt; 4     2     2 dbl       &lt;NA&gt;     20
#&gt; 5     1     3 chr       foo      NA
#&gt; 6     2     3 chr       bar      NA</div><div class='input'><span class='fu'>as_cells</span>(<span class='no'>x</span>, <span class='kw'>col_names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; # A tibble: 6 x 5
#&gt;     row   col data_type chr     dbl
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;
#&gt; 1     1     1 chr       a        NA
#&gt; 2     2     1 dbl       &lt;NA&gt;     10
#&gt; 3     3     1 dbl       &lt;NA&gt;     20
#&gt; 4     1     2 chr       b        NA
#&gt; 5     2     2 chr       foo      NA
#&gt; 6     3     2 chr       bar      NA</div><div class='input'>
<span class='co'># 'list' columns are undisturbed</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>), <span class='kw'>stringsAsFactors</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>y</span>$<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='fl'>1</span>:<span class='fl'>2</span>, <span class='fl'>3</span>:<span class='fl'>4</span>)
<span class='no'>y</span></div><div class='output co'>#&gt;   a    b
#&gt; 1 a 1, 2
#&gt; 2 b 3, 4</div><div class='input'><span class='fu'>as_cells</span>(<span class='no'>y</span>)</div><div class='output co'>#&gt; # A tibble: 4 x 5
#&gt;     row   col data_type chr   list     
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt; &lt;list&gt;   
#&gt; 1     1     1 chr       a     &lt;NULL&gt;   
#&gt; 2     2     1 chr       b     &lt;NULL&gt;   
#&gt; 3     1     2 list      &lt;NA&gt;  &lt;int [2]&gt;
#&gt; 4     2     2 list      &lt;NA&gt;  &lt;int [2]&gt;</div><div class='input'>
<span class='co'># Factors are preserved by being wrapped in lists so that their levels don't</span>
<span class='co'># conflict.  Blanks are NULLs.</span>
<span class='no'>z</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='fu'>factor</span>(<span class='fu'>c</span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>)),
                <span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'>factor</span>(<span class='fu'>c</span>(<span class='st'>"c"</span>, <span class='st'>"d"</span>), <span class='kw'>ordered</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))
<span class='fu'>as_cells</span>(<span class='no'>z</span>)</div><div class='output co'>#&gt; # A tibble: 4 x 5
#&gt;     row   col data_type fct       ord      
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;list&gt;    &lt;list&gt;   
#&gt; 1     1     1 fct       &lt;fct [1]&gt; &lt;NULL&gt;   
#&gt; 2     2     1 fct       &lt;fct [1]&gt; &lt;NULL&gt;   
#&gt; 3     1     2 ord       &lt;NULL&gt;    &lt;ord [1]&gt;
#&gt; 4     2     2 ord       &lt;NULL&gt;    &lt;ord [1]&gt;</div><div class='input'><span class='fu'>as_cells</span>(<span class='no'>z</span>)$<span class='no'>fct</span></div><div class='output co'>#&gt; [[1]]
#&gt; [1] a
#&gt; Levels: a b
#&gt; 
#&gt; [[2]]
#&gt; [1] b
#&gt; Levels: a b
#&gt; 
#&gt; [[3]]
#&gt; NULL
#&gt; 
#&gt; [[4]]
#&gt; NULL
#&gt; </div><div class='input'><span class='fu'>as_cells</span>(<span class='no'>z</span>)$<span class='no'>ord</span></div><div class='output co'>#&gt; [[1]]
#&gt; NULL
#&gt; 
#&gt; [[2]]
#&gt; NULL
#&gt; 
#&gt; [[3]]
#&gt; [1] c
#&gt; Levels: c &lt; d
#&gt; 
#&gt; [[4]]
#&gt; [1] d
#&gt; Levels: c &lt; d
#&gt; </div><div class='input'>
<span class='co'># HTML tables can be extracted from the output of xml2::read_html().  These</span>
<span class='co'># are returned as a list of tables, similar to rvest::html_table().  The</span>
<span class='co'># value of each cell is its standalone HTML string, which can contain</span>
<span class='co'># anything -- even another table.</span>

<span class='no'>colspan</span> <span class='kw'>&lt;-</span> <span class='fu'>system.file</span>(<span class='st'>"extdata"</span>, <span class='st'>"colspan.html"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"unpivotr"</span>)
<span class='no'>rowspan</span> <span class='kw'>&lt;-</span> <span class='fu'>system.file</span>(<span class='st'>"extdata"</span>, <span class='st'>"rowspan.html"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"unpivotr"</span>)
<span class='no'>nested</span> <span class='kw'>&lt;-</span> <span class='fu'>system.file</span>(<span class='st'>"extdata"</span>, <span class='st'>"nested.html"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"unpivotr"</span>)</div><span class='co'># NOT RUN {</span>
<span class='fu'>browseURL</span>(<span class='no'>colspan</span>)
<span class='fu'>browseURL</span>(<span class='no'>rowspan</span>)
<span class='fu'>browseURL</span>(<span class='no'>nestedspan</span>)
<span class='co'># }</span><div class='input'>
<span class='fu'>as_cells</span>(<span class='kw pkg'>xml2</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/xml2/topics/read_xml'>read_html</a></span>(<span class='no'>colspan</span>))</div><div class='output co'>#&gt; [[1]]
#&gt; # A tibble: 4 x 4
#&gt;     row   col data_type html                                    
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                                   
#&gt; 1     1     1 html      "&lt;th colspan=\"2\"&gt;Header (1, 1:2)&lt;/th&gt;"
#&gt; 2     2     1 html      &lt;td&gt;cell (2, 1)&lt;/td&gt;                    
#&gt; 3     1     2 html      &lt;NA&gt;                                    
#&gt; 4     2     2 html      &lt;td&gt;cell (2, 2)&lt;/td&gt;                    
#&gt; </div><div class='input'><span class='fu'>as_cells</span>(<span class='kw pkg'>xml2</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/xml2/topics/read_xml'>read_html</a></span>(<span class='no'>rowspan</span>))</div><div class='output co'>#&gt; [[1]]
#&gt; # A tibble: 4 x 4
#&gt;     row   col data_type html                                    
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                                   
#&gt; 1     1     1 html      "&lt;th rowspan=\"2\"&gt;Header (1:2, 1)&lt;/th&gt;"
#&gt; 2     2     1 html      &lt;NA&gt;                                    
#&gt; 3     1     2 html      &lt;th&gt;Header (1, 2)&lt;/th&gt;                  
#&gt; 4     2     2 html      &lt;td&gt;cell (2, 2)&lt;/td&gt;                    
#&gt; </div><div class='input'><span class='fu'>as_cells</span>(<span class='kw pkg'>xml2</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/xml2/topics/read_xml'>read_html</a></span>(<span class='no'>nested</span>))</div><div class='output co'>#&gt; [[1]]
#&gt; # A tibble: 4 x 4
#&gt;     row   col data_type html                                                    
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                                                   
#&gt; 1     1     1 html      &lt;th&gt;Header (1, 1)&lt;/th&gt;                                  
#&gt; 2     2     1 html      &lt;td&gt;cell (2, 1)&lt;/td&gt;                                    
#&gt; 3     1     2 html      &lt;th&gt;Header (1, 2)&lt;/th&gt;                                  
#&gt; 4     2     2 html      "&lt;td&gt;\n          &lt;table&gt;\n&lt;tr&gt;\n&lt;th&gt;Header (2, 2)(1, 1)…
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

