<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Join data cells to headers — enhead • unpivotr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Join data cells to headers — enhead" />

<meta property="og:description" content="Data cells in a table are associated with header cells by proximity.
enhead() joins a data frame of data cells to a data frame of header cells,
choosing the nearest header cells in the given direction." />
<meta name="twitter:card" content="summary" />


<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-5');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unpivotr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/compass-directions.html">Compass Directions</a>
    </li>
    <li>
      <a href="../articles/html.html">HTML Tables</a>
    </li>
    <li>
      <a href="../articles/small-multiples.html">Small Multiples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nacnudus/unpivotr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Join data cells to headers</h1>
    <small class="dont-index">Source: <a href='https://github.com/nacnudus/unpivotr/blob/master/R/enhead.R'><code>R/enhead.R</code></a></small>
    <div class="hidden name"><code>enhead.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Data cells in a table are associated with header cells by proximity.
<code>enhead()</code> joins a data frame of data cells to a data frame of header cells,
choosing the nearest header cells in the given direction.</p>
    
    </div>

    <pre class="usage"><span class='fu'>enhead</span>(<span class='no'>data_cells</span>, <span class='no'>header_cells</span>, <span class='no'>direction</span>, <span class='kw'>drop</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data_cells</th>
      <td><p>Data frame of data cells with at least the columns 'row'
and 'column', which are <code>numeric</code> or <code>integer</code>.</p></td>
    </tr>
    <tr>
      <th>header_cells</th>
      <td><p>Data frame of header cells with at least the columns
'row' and 'column', which are numeric/integer vectors.</p></td>
    </tr>
    <tr>
      <th>direction</th>
      <td><p>The direction between a data cell and its header, one of
<code>"N"</code>, <code>"E"</code>, <code>"S"</code>, <code>"W"</code>, <code>"NNW"</code>, <code>"NNE"</code>, <code>"ENE"</code>, <code>"ESE"</code>, <code>"SSE"</code>,
<code>"SSW"</code>. <code>"WSW"</code>, <code>"WNW"</code>, <code>"ABOVE"</code>, <code>"BELOW"</code>, <code>"LEFT"</code> and <code>"RIGHT"</code>.  See
'details'.</p></td>
    </tr>
    <tr>
      <th>drop</th>
      <td><p>Logical vector length 1. Whether data cells that can't be
associated with a header should be dropped.  Default: <code>TRUE</code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Headers are associated with data by proximity in a given direction.  The
directions are mapped to the points of the compass, where 'N' is north (up),
'E' is east (right), and so on.  <code>enhead()</code> finds the nearest header to
a given data cell in a given direction, and joins it to the data cell.</p>
<p>The most common directions to search are <code>"NNW"</code> (for left-aligned headers at
the top of the table) and <code>"WNW"</code> for top-aligned headers at the side of the
table.</p>
<p>The full list of available directions is <code>"N"</code>, <code>"E"</code>, <code>"S"</code>, <code>"W"</code>, <code>"NNW"</code>,
<code>"NNE"</code>, <code>"ENE"</code>, <code>"ESE"</code>, <code>"SSE"</code>, <code>"SSW"</code>, <code>"WSW"</code>, <code>"WNW"</code>, <code>"ABOVE"</code>,
<code>"BELOW"</code>, <code>"LEFT"</code>, <code>"RIGHT"</code>.  For convenience, these directions are
provided as their own functions, wrapping the concept of <code>enhead()</code>.</p>
<p>The difference between <code>"N"</code> and <code>"ABOVE"</code> (and similar pairs of directions)
is that <code>"N"</code> finds headers directly above the data cell, whereas <code>"ABOVE"</code>
matches the nearest header, whether above-left, above-right or directly above
the data cell.  This is useful for matching headers that are not aligned to
the edge of the data cells that they refer to.  There can be a tie in the
directions <code>"ABOVE"</code>, <code>"BELOW"</code>, <code>"LEFT"</code> and <code>"RIGHT"</code> , causing <code>NA</code>s to be
returned in the place of header values.  Avoid ties by using <code><a href='justify.html'>justify()</a></code>
first to align header cells to the corner of the data cells they describe.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>dplyr</span>)</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following object is masked from ‘package:testthat’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    matches</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'><span class='co'># Load some pivoted data</span>
(<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='no'>purpose</span>$<span class='no'>`NNW WNW`</span>)</div><div class='output co'>#&gt;                            X2      X3     X4     X5    X6     X7
#&gt; 1                        &lt;NA&gt;    &lt;NA&gt; Female   &lt;NA&gt;  Male   &lt;NA&gt;
#&gt; 2                        &lt;NA&gt;    &lt;NA&gt;  0 - 6 7 - 10 0 - 6 7 - 10
#&gt; 3           Bachelor's degree 15 - 24   7000  27000  &lt;NA&gt;  13000
#&gt; 4                        &lt;NA&gt; 25 - 44  12000 137000  9000  81000
#&gt; 5                        &lt;NA&gt; 45 - 64  10000  64000  7000  66000
#&gt; 6                        &lt;NA&gt;     65+   &lt;NA&gt;  18000  7000  17000
#&gt; 7                 Certificate 15 - 24  29000 161000 30000 190000
#&gt; 8                        &lt;NA&gt; 25 - 44  34000 179000 31000 219000
#&gt; 9                        &lt;NA&gt; 45 - 64  30000 210000 23000 199000
#&gt; 10                       &lt;NA&gt;     65+  12000  77000  8000 107000
#&gt; 11                    Diploma 15 - 24   &lt;NA&gt;  14000  9000  11000
#&gt; 12                       &lt;NA&gt; 25 - 44  10000  66000  8000  47000
#&gt; 13                       &lt;NA&gt; 45 - 64   6000  68000  5000  58000
#&gt; 14                       &lt;NA&gt;     65+   5000  41000  1000  34000
#&gt; 15           No Qualification 15 - 24  10000  43000 12000  37000
#&gt; 16                       &lt;NA&gt; 25 - 44  11000  36000 21000  50000
#&gt; 17                       &lt;NA&gt; 45 - 64  19000  91000 17000  75000
#&gt; 18                       &lt;NA&gt;     65+  16000 118000  9000  66000
#&gt; 19 Postgraduate qualification 15 - 24   &lt;NA&gt;   6000  &lt;NA&gt;   &lt;NA&gt;
#&gt; 20                       &lt;NA&gt; 25 - 44   5000  86000  7000  60000
#&gt; 21                       &lt;NA&gt; 45 - 64   6000  55000  6000  68000
#&gt; 22                       &lt;NA&gt;     65+   &lt;NA&gt;  13000  &lt;NA&gt;  18000</div><div class='input'><span class='co'># Make a tidy representation</span>
<span class='no'>cells</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='as_cells.html'>as_cells</a></span>(<span class='no'>x</span>)
<span class='no'>cells</span> <span class='kw'>&lt;-</span> <span class='no'>cells</span>[!<span class='fu'>is.na</span>(<span class='no'>cells</span>$<span class='no'>chr</span>), ]
<span class='fu'>head</span>(<span class='no'>cells</span>)</div><div class='output co'>#&gt; # A tibble: 6 x 4
#&gt;     row   col data_type chr                       
#&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                     
#&gt; 1     3     1 chr       Bachelor's degree         
#&gt; 2     7     1 chr       Certificate               
#&gt; 3    11     1 chr       Diploma                   
#&gt; 4    15     1 chr       No Qualification          
#&gt; 5    19     1 chr       Postgraduate qualification
#&gt; 6     3     2 chr       15 - 24                   </div><div class='input'><span class='co'># Select the cells containing the values</span>
<span class='no'>data_cells</span> <span class='kw'>&lt;-</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>cells</span>, <span class='no'>row</span> <span class='kw'>&gt;=</span> <span class='fl'>3</span>, <span class='no'>col</span> <span class='kw'>&gt;=</span> <span class='fl'>3</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>transmute</a></span>(<span class='no'>row</span>, <span class='no'>col</span>, <span class='kw'>count</span> <span class='kw'>=</span> <span class='fu'>as.integer</span>(<span class='no'>chr</span>))
<span class='fu'>head</span>(<span class='no'>data_cells</span>)</div><div class='output co'>#&gt; # A tibble: 6 x 3
#&gt;     row   col count
#&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;
#&gt; 1     3     3  7000
#&gt; 2     4     3 12000
#&gt; 3     5     3 10000
#&gt; 4     7     3 29000
#&gt; 5     8     3 34000
#&gt; 6     9     3 30000</div><div class='input'><span class='co'># Select the headers</span>
<span class='no'>qualification</span> <span class='kw'>&lt;-</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>cells</span>, <span class='no'>col</span> <span class='kw'>==</span> <span class='fl'>1</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(<span class='no'>row</span>, <span class='no'>col</span>, <span class='kw'>qualification</span> <span class='kw'>=</span> <span class='no'>chr</span>)
<span class='no'>age</span> <span class='kw'>&lt;-</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>cells</span>, <span class='no'>col</span> <span class='kw'>==</span> <span class='fl'>2</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(<span class='no'>row</span>, <span class='no'>col</span>, <span class='kw'>age</span> <span class='kw'>=</span> <span class='no'>chr</span>)
<span class='no'>gender</span> <span class='kw'>&lt;-</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>cells</span>, <span class='no'>row</span> <span class='kw'>==</span> <span class='fl'>1</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(<span class='no'>row</span>, <span class='no'>col</span>, <span class='kw'>gender</span> <span class='kw'>=</span> <span class='no'>chr</span>)
<span class='no'>satisfaction</span> <span class='kw'>&lt;-</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>cells</span>, <span class='no'>row</span> <span class='kw'>==</span> <span class='fl'>2</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(<span class='no'>row</span>, <span class='no'>col</span>, <span class='kw'>satisfaction</span> <span class='kw'>=</span> <span class='no'>chr</span>)
<span class='co'># From each data cell, search for the nearest one of each of the headers</span>
<span class='no'>data_cells</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>enhead</span>(<span class='no'>gender</span>, <span class='st'>"NNW"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>enhead</span>(<span class='no'>satisfaction</span>, <span class='st'>"N"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>enhead</span>(<span class='no'>qualification</span>, <span class='st'>"WNW"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>enhead</span>(<span class='no'>age</span>, <span class='st'>"W"</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span>(-<span class='no'>row</span>, -<span class='no'>col</span>)</div><div class='output co'>#&gt; # A tibble: 72 x 5
#&gt;     count gender satisfaction qualification     age    
#&gt;     &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;             &lt;chr&gt;  
#&gt;  1   7000 Female 0 - 6        Bachelor's degree 15 - 24
#&gt;  2  12000 Female 0 - 6        Bachelor's degree 25 - 44
#&gt;  3  10000 Female 0 - 6        Bachelor's degree 45 - 64
#&gt;  4  27000 Female 7 - 10       Bachelor's degree 15 - 24
#&gt;  5 137000 Female 7 - 10       Bachelor's degree 25 - 44
#&gt;  6  64000 Female 7 - 10       Bachelor's degree 45 - 64
#&gt;  7  18000 Female 7 - 10       Bachelor's degree 65+    
#&gt;  8   9000 Male   0 - 6        Bachelor's degree 25 - 44
#&gt;  9   7000 Male   0 - 6        Bachelor's degree 45 - 64
#&gt; 10   7000 Male   0 - 6        Bachelor's degree 65+    
#&gt; # … with 62 more rows</div><div class='input'>
<span class='co'># The `drop` argument controls what happens when for some cells there is no</span>
<span class='co'># header in the given direction. When `drop = TRUE` (the default), cells that</span>
<span class='co'># can't be joined to a header are dropped.  Otherwise they are kept.</span>
<span class='fu'>enhead</span>(<span class='no'>data_cells</span>, <span class='no'>gender</span>, <span class='st'>"N"</span>)</div><div class='output co'>#&gt; # A tibble: 33 x 4
#&gt;      row   col count gender
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
#&gt;  1     3     3  7000 Female
#&gt;  2     4     3 12000 Female
#&gt;  3     5     3 10000 Female
#&gt;  4     7     3 29000 Female
#&gt;  5     8     3 34000 Female
#&gt;  6     9     3 30000 Female
#&gt;  7    10     3 12000 Female
#&gt;  8    12     3 10000 Female
#&gt;  9    13     3  6000 Female
#&gt; 10    14     3  5000 Female
#&gt; # … with 23 more rows</div><div class='input'><span class='fu'>enhead</span>(<span class='no'>data_cells</span>, <span class='no'>gender</span>, <span class='st'>"N"</span>, <span class='kw'>drop</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; # A tibble: 72 x 4
#&gt;      row   col count gender
#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
#&gt;  1     3     3  7000 Female
#&gt;  2     4     3 12000 Female
#&gt;  3     5     3 10000 Female
#&gt;  4     7     3 29000 Female
#&gt;  5     8     3 34000 Female
#&gt;  6     9     3 30000 Female
#&gt;  7    10     3 12000 Female
#&gt;  8    12     3 10000 Female
#&gt;  9    13     3  6000 Female
#&gt; 10    14     3  5000 Female
#&gt; # … with 62 more rows</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

